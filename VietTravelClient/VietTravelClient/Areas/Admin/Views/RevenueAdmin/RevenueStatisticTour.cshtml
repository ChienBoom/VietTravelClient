@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Thống kê";
    Revenue revenue = (Revenue)ViewData["Revenue"];
    string yearValue = (string)ViewData["YearValue"];
    List<string> labels = revenue.Labels;
    List<List<Ticket>> data = revenue.Data;
    int Count = labels.Count;
    List<decimal> decimals = new List<decimal>();
    List<string> lstYear = new List<string>();
    lstYear.Add("2023");
    lstYear.Add("2024");
    foreach (List<Ticket> tickets in data)
    {
        decimal sumdecimal = 0;
        if (tickets.Count < 1) decimals.Add(sumdecimal);
        else
        {
            foreach (Ticket t in tickets)
            {
                sumdecimal += t.TourPackage.LastPrice;
            }
            decimals.Add(sumdecimal);
        }
    }
}
<style>
    .modal-dialog {
        max-width: 1000px;
    }
</style>
<body>
    <div class="row" style="margin-top: 40px; margin-bottom: 10px;">
        <div class="col-10">
            <div class="text-info font-italic" style="font-size:30px; margin-left: 100px;">QUẢN LÝ THỐNG KÊ</div>
        </div>
    </div>
    <div class="row">
        <div hidden>
            <input type="text" id="revenueCount" value="@Count" />
            <input type="text" id="revenueLabel" value="@revenue.Label" />
            <select id="revenueLabels" multiple>
                @{
                    for (int i = 1; i <= Count; i++)
                    {
                        string item = labels[i - 1];
                        <option value="@item" selected>@item</option>
                    }
                }
            </select>
            <select id="revenueDecimals" multiple>
                @{
                    for (int i = 1; i <= Count; i++)
                    {
                        decimal item = decimals[i - 1];
                        <option value="@item" selected>@item</option>
                    }
                }
            </select>
        </div>
        <div class="col-3 col-sm-3 col-md-3 row" style="margin-top: 100px;">
            <div class="col-12 col-md-12 col-sm-12 row" style="margin-left: 50px;">
                <a asp-area="Admin" asp-controller="RevenueAdmin" asp-action="RevenueStatisticMonth" asp-route-yearValue="@yearValue" class="col-12 col-md-12 col-sm-12 btn btn-info rounded border-info" style="height: 60px; display: flex; align-items: center; justify-content: center;">Thống kê doanh thu theo Tháng</a>
                @*<div class="col-1 col-md-1 col-sm-1" style="height: 40px;"></div>
                    <button class="col-3 col-sm-3 col-md-3 btn btn-info rounded border-info" style="height: 60px;">Xem chi tiết</button>*@
            </div>
            <div class="col-12 col-md-12 col-sm-12 row" style="margin-left: 50px;">
                <a asp-area="Admin" asp-controller="RevenueAdmin" asp-action="RevenueStatisticCity" asp-route-yearValue="@yearValue" class="col-12 col-md-12 col-sm-12 btn btn-info rounded border-info" style="height: 60px; display: flex; align-items: center; justify-content: center;">Thống kê doanh thu theo Thành phố</a>
                @*<div class="col-1 col-md-1 col-sm-1" style="height: 40px;"></div>
                    <button class="col-3 col-sm-3 col-md-3 btn btn-info rounded border-info" style="height: 60px;">Xem chi tiết</button>*@
            </div>
            <div class="col-12 col-md-12 col-sm-12 row" style="margin-left: 50px;">
                <a asp-area="Admin" asp-controller="RevenueAdmin" asp-action="RevenueStatisticTour" asp-route-yearValue="@yearValue" class="col-12 col-md-12 col-sm-12 btn btn-info rounded border-info" style="height: 60px; display: flex; align-items: center; justify-content: center;">Thống kê doanh thu theo Tour</a>
                @*<div class="col-1 col-md-1 col-sm-1" style="height: 40px;"></div>
                    <button class="col-3 col-sm-3 col-md-3 btn btn-info rounded border-info" style="height: 60px;">Xem chi tiết</button>*@
            </div>
            <div class="col-12 col-md-12 col-sm-12 row" style="margin-left: 50px;">
                <a asp-area="Admin" asp-controller="RevenueAdmin" asp-action="VisitorStatisticMonth" asp-route-yearValue="@yearValue" class="col-12 col-md-12 col-sm-12 btn btn-info rounded border-info" style="height: 60px; display: flex; align-items: center; justify-content: center;">Thống kê lượt khách theo Tháng</a>
                @*<div class="col-1 col-md-1 col-sm-1" style="height: 40px;"></div>
                    <button class="col-3 col-sm-3 col-md-3 btn btn-info rounded border-info" style="height: 60px;">Xem chi tiết</button>*@
            </div>
            <div class="col-12 col-md-12 col-sm-12 row" style="margin-left: 50px;">
                <a asp-area="Admin" asp-controller="RevenueAdmin" asp-action="VisitorStatisticCity" asp-route-yearValue="@yearValue" class="col-12 col-md-12 col-sm-12 btn btn-info rounded border-info" style="height: 60px; display: flex; align-items: center; justify-content: center;">Thống kê lượt khách theo Thành phố</a>
                @*<div class="col-1 col-md-1 col-sm-1" style="height: 40px;"></div>
                    <button class="col-3 col-sm-3 col-md-3 btn btn-info rounded border-info" style="height: 60px;">Xem chi tiết</button>*@
            </div>
            <div class="col-12 col-md-12 col-sm-12 row" style="margin-left: 50px;">
                <a asp-area="Admin" asp-controller="RevenueAdmin" asp-action="VisitorStatisticTour" asp-route-yearValue="@yearValue" class="col-12 col-md-12 col-sm-12 btn btn-info rounded border-info" style="height: 60px; display: flex; align-items: center; justify-content: center;">Thống kê lượt khách theo Tour</a>
                @*<div class="col-1 col-md-1 col-sm-1" style="height: 40px;"></div>
                    <button class="col-3 col-sm-3 col-md-3 btn btn-info rounded border-info" style="height: 60px;">Xem chi tiết</button>*@
            </div>
        </div>
        <div class="col-9 col-sm-9 col-md-9 row">
            <div class="col-12 col-sm-12 col-md-12 row">
                <div class="col-4 col-sm-4 col-md-4"></div>
                <div class="col-6 col-sm-6 col-md-6 row">
                    <form class="col-12 col-sm-12 col-md-12 row" asp-area="Admin" asp-controller="RevenueAdmin" asp-action="SelectedYearStatistic" method="post">
                        <div class="col-5 col-sm-5 col-md-5" style="font-size: 1.2rem;">Lựa chọn năm thống kê:</div>
                        <select id="yearValue" name="yearValue" class="col-3 col-sm-3 col-md-3 btn btn-info rounded border-info" style="height: 60px; display: flex; align-items: center; justify-content: center;">
                            @{
                                foreach (string year in lstYear)
                                {
                                    if (yearValue.Equals(year))
                                    {
                                        <option value=@year style="text-align: center;" selected>@year</option>
                                    }
                                    else
                                    {
                                        <option value=@year style="text-align: center;">@year</option>
                                    }
                                }
                            }
                        </select>
                        <div class="col-1 col-sm-1 col-md-1"></div>
                        <button type="submit" class="col-3 col-sm-3 col-md-3 btn btn-info rounded border-info" style="height: 60px; display: flex; align-items: center; justify-content: center;">Xác nhận</button>
                    </form>
                </div>
                <div class="col-2 col-sm-2 col-md-2 row">
                    <div class="col-2 col-sm-2 col-md-2"></div>
                    <a class="col-10 col-sm-10 col-md-10 btn btn-info rounded border-info" data-toggle="modal" data-target="#ReportDetail" style="height: 60px; display: flex; align-items: center; justify-content: center;">Xem chi tiết</a>
                </div>
            </div>
            <canvas id="myChart" class="col-12 col-sm-12 col-md-12"></canvas>
        </div>
    </div>

    @*Modal ReportDetail*@
    <div id="ReportDetail" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="padding-left: 40px;">
                <div class="modal-header">
                    <h4 class="modal-title text-info">CHI TIẾT THỐNG KÊ DOANH THU THEO TOUR</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form>
                    <div class="modal-body row">
                        <table class="col-10 col-sm-10 col-md-10 border" style="border: 1px; border-color: black;">
                            <tr class="">
                                <th style="width : 10%" class="text-center bg-info text-light border">STT</th>
                                <th style="width : 40%" class="text-center bg-info text-light border">Tên Tour</th>
                                <th style="width : 50%" class="text-center bg-info text-light border">Doanh thu(VNĐ)</th>
                            </tr>
                            @{
                                for (int i = 1; i <= Count; i++)
                                {
                                    string label = labels[i - 1];
                                    decimal sumRevenue = decimals[i - 1];
                                    <tr>
                                        <td class="text-center border">@i</td>
                                        <td class="text-center border">@label</td>
                                        <td class="text-center border">@sumRevenue.ToString("N2")</td>
                                    </tr>
                                }
                            }
                        </table>
                    </div>
                    <div class="modal-footer">
                        <a asp-area="Admin" asp-controller="ReportAdmin" asp-action="RevenueTourReport" asp-route-yearValue="@yearValue" type="button" class="btn btn-success">Xuất Excel</a>
                        <button type="button" class="btn btn-info" data-dismiss="modal">Thoát</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
<script>
    debugger
    $(document).ready(function () {
        var label = $('#revenueLabel').val();
        var labels = $('#revenueLabels').val();
        var data = $('#revenueDecimals').val();
        var intData = [];
        for (var i = 0; i < data.length; i++) {
            var intI = parseInt(data[i], 10);
            intData.push(intI);
        }
        let myChart = document.getElementById('myChart').getContext('2d');
        // Global Options
        Chart.defaults.global.defaultFontFamily = 'Lato';
        Chart.defaults.global.defaultFontSize = 18;
        Chart.defaults.global.defaultFontColor = '#777';

        let massPopChart = new Chart(myChart, {
            type: 'horizontalBar', // bar, horizontalBar, pie, line, doughnut, radar, polarArea
            data: {
                labels: labels,
                datasets: [{
                    label: label,
                    data: intData,
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    //backgroundColor: [
                    //    'rgba(255, 99, 132, 0.6)',
                    //    'rgba(54, 162, 235, 0.6)',
                    //    'rgba(255, 206, 86, 0.6)',
                    //    'rgba(75, 192, 192, 0.6)',
                    //    'rgba(153, 102, 255, 0.6)',
                    //    'rgba(255, 159, 64, 0.6)',
                    //    'rgba(255, 99, 132, 0.6)'
                    //],
                    borderWidth: 1,
                    borderColor: '#777',
                    hoverBorderWidth: 3,
                    hoverBorderColor: '#000'
                }]
            },
            options: {
                title: {
                    display: true,
                    text: 'Thống kê doanh thu các Tour',
                    //   fontColor: 'blue',
                    fontSize: 25
                },
                legend: {
                    display: true,
                    position: 'right',
                    labels: {
                        fontColor: '#000'
                    }
                },
                layout: {
                    padding: {
                        left: 50,
                        right: 0,
                        bottom: 0,
                        top: 0
                    }
                },
                tooltips: {
                    enabled: true
                }
            }
        });
    })
</script>
